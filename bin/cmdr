#!/usr/bin/env bash

create() {
  local template="${COPIER_TEMPLATE:-`pwd`}"
  local path="$1"
  if [ -z "$path" ]; then
    echo "Error: Missing path for 'create' command."
    echo "Usage: $0 create path/to/instance [...args]"
    exit 1
  fi
  shift

  echo "Creating instance at: $path"
  copier copy --trust "$template" "$path" -d "template_type=repo" $@
}

# The main function to handle command dispatch.
main() {
  # Check if a command was provided.
  if [ -z "$1" ]; then
    echo "Usage: $0 [command] [...args]"
    echo "Commands:"
    echo "  create <path> [...args]   - Creates a new instance."
    echo "  help                      - Shows this help message."
    exit 0
  fi

  local command="$1"
  shift # Remove the command so remaining arguments are passed to the function.

  case "$command" in
    create | c)
      create "$@"
      ;;
    -h | --help | help)
      echo "Usage: $0 [command] [...args]"
      echo "Commands:"
      echo "  create <path>  - Creates a new instance."
      echo "  help           - Shows this help message."
      ;;
    *)
      echo "Error: Unknown command '$command'" >&2
      echo "Use '$0 --help' for more information."
      exit 1
      ;;
  esac
}

main "$@"
